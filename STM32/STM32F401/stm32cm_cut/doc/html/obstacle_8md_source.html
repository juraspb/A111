<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.13"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Acconeer API: /home/ai/jenkins/workspace/sw-main@2/doc/user_guides/rss/obstacle.md Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Acconeer API
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.13 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('obstacle_8md.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">/home/ai/jenkins/workspace/sw-main@2/doc/user_guides/rss/obstacle.md</div>  </div>
</div><!--header-->
<div class="contents">
<a href="obstacle_8md.html">Go to the documentation of this file.</a><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;# Obstacle Detector {#obstacle}</div><div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;</div><div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;The obstacle detector algorithm is based on the synthetic aperture radar (SAR) principle. The main goal of the detector is to find obstacles in front of the sensor and estimate their distance and angle. In an application where the sensor is installed on a robot (such as vacuum cleaners or lawn mowers), the object data can be used to issue movement commands to the robot to avoid and circumnavigate the found obstacles.</div><div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;</div><div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;![](obstacle_intro.png)</div><div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;</div><div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;Due to a half power beam width (HPBW) of 60 degrees along the H-plane of the sensor, detection of obstacles works best at 30 degrees from boresight angles. Note that strong reflectors, such as glass walls, usually can be seen up to almost 90 degrees from boresight. At the core of the detection algorithm is a fast Fourier transform (FFT), which is used to improve the signal-to-noise ratio (SNR) of obstacles in the vicinity of the radar sensor for extraction of angle alpha and distance d.</div><div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;</div><div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;Four basic steps are repeated in this algorithm:</div><div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;</div><div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;* Collecting radar sweeps from the IQ Service at a sweep frequency of fs</div><div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;</div><div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;* Perform FFT of N consecutive sweeps and estimate the power spectral density (PSD)</div><div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;</div><div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;* Perform peak detection on the PSD</div><div class="line"><a name="l00016"></a><span class="lineno">   16</span>&#160;</div><div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160;* Report distance d and estimate of angle alpha for found peaks (obstacles)</div><div class="line"><a name="l00018"></a><span class="lineno">   18</span>&#160;</div><div class="line"><a name="l00019"></a><span class="lineno">   19</span>&#160;For further understanding and information we recommend downloading our exploration tool, available from [www.developer.acconeer.com](www.developer.acconeer.com).</div><div class="line"><a name="l00020"></a><span class="lineno">   20</span>&#160;</div><div class="line"><a name="l00021"></a><span class="lineno">   21</span>&#160;# Detecting Obstacles</div><div class="line"><a name="l00022"></a><span class="lineno">   22</span>&#160;</div><div class="line"><a name="l00023"></a><span class="lineno">   23</span>&#160;Detecting obstacles is a question of how well we can distinguish radar signals reflected off them from the noise floor of the sensor. While the sensor has very well-defined radar emission properties, radar scattering and reflection off obstacles depends strongly on their individual physical properties. Hence, the detection probability for obstacles is tied to the following key characteristics:</div><div class="line"><a name="l00024"></a><span class="lineno">   24</span>&#160;</div><div class="line"><a name="l00025"></a><span class="lineno">   25</span>&#160;* distance of obstacle to radar sensor</div><div class="line"><a name="l00026"></a><span class="lineno">   26</span>&#160;</div><div class="line"><a name="l00027"></a><span class="lineno">   27</span>&#160;* angle of obstacle to radar sensor</div><div class="line"><a name="l00028"></a><span class="lineno">   28</span>&#160;</div><div class="line"><a name="l00029"></a><span class="lineno">   29</span>&#160;* reflectivity of obstacle at 60.5 GHz given by shape and material</div><div class="line"><a name="l00030"></a><span class="lineno">   30</span>&#160;</div><div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160;In particular, certain materials are known to only weakly reflect radar, while others are excellent reflectors. Untreated wood followed by treated wood and some plastic types fall in the first category and thus the maximum distance at which obstacles made from these materials can be detected is reduced. Metal, glass and water on the other hand are very good reflectors and can often be detected at quite far distances and large angles. Most other materials have reflectivity properties in between those two groups (most plastic types, tiles, granite) can be detected reasonably well at normal distances. Since radar emission is far outside the visible region of the EM-spectrum, color of materials does not matter.</div><div class="line"><a name="l00032"></a><span class="lineno">   32</span>&#160;</div><div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160;It is important to understand, that radar signals may reflect off flat surfaces like a window or door in the same way visible light reflects off a mirror. Thus, if the obstacle has a large flat surface, which has a shallow angle with respect to the radar sensor normal, the obstacle might not be detected very well even if it is made from well reflecting material.</div><div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160;</div><div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160;![](obstacle_detecting.png)</div><div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160;</div><div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160;Figure above show object with normal incidence resulting in good reflectivity and object with oblique incidence resulting in reduced detectability</div><div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160;</div><div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;# Understanding the Results</div><div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160;</div><div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;The obstacle detector reports obstacles with 3 parameters, distance d, angle alpha and amplitude A. The amplitude is a measure of how much signal was reflected for that specific object; a value that is important for setting optimized thresholds for the obstacle detector.</div><div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160;</div><div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;![](obstacle_result.png)</div><div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;</div><div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;The distance is the actual distance of the obstacle to the radar sensor and the angle is the measured with respect to the direction of motion of the radar sensor. If you need the “normal” distance of the obstacle to the sensor, you can calculate it via the relation cos(alpha)d.</div><div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;</div><div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;It is important to keep in mind that the reported angle is only reliable if the radar is moving with a known velocity and the object is at rest. For scenarios, where both, the sensor/robot and the object are moving, no definitive conclusion can be made about the objects true angle. The reason for this is that the angle is only inferred, i.e. calculated from the measured radial velocity of the object and not directly measured.</div><div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;</div><div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;Since the obstacle’s radial velocity is obtained by performing an FFT over a given number of sweeps, it should be noted that there is a maximum velocity v that the detector can measure is</div><div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;</div><div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;![](obstacle_result_2.png)</div><div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;</div><div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;where f is the sweep frequency and lambda is the radar wavelength (~5.0 mm). For objects that move at higher velocities, the reported object velocity, and therefore also angle, is incorrect. Thus, it is important to initialize the detector with settings that reflect the expected velocities for the desired application. For example, with a sweep frequency of 250 Hz, objects can be reliably detected at velocities below 30 cm/s. If one knows the radar is mounted on the robot so that object moving in one only direction can be observed, the maximum measurable velocity doubles to 60 cm/s.</div><div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;</div><div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;The highest possible sweep frequency is depending on the MCU used and the range being scanned each sweep.</div><div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;</div><div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;## Output from the Detector</div><div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;</div><div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;Detections are fetched from the obstacle detector.</div><div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;</div><div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;```c</div><div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;acc_obstacle_t obstacles[max_number_of_obstacles];</div><div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;acc_detector_obstacle_t obstacle_data;</div><div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;bool status = true;</div><div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;</div><div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;acc_detector_obstacle_result_info_t result_info;</div><div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;</div><div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;obstacle_data.obstacles = obstacles;</div><div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;</div><div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;do</div><div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;{</div><div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160; status = acc_detector_obstacle_get_next(handle, &amp;obstacle_data, &amp;result_info);</div><div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;}</div><div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;while (status &amp;&amp; !result_info.data_available);</div><div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;```</div><div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;</div><div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;Detections will be available in obstacle_data when data_available is set. One obstacle is represented by an acc_detector_obstacle_t struct.</div><div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;</div><div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;```c</div><div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;typedef struct</div><div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;{</div><div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160; float radial_velocity;</div><div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160; float distance;</div><div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160; float amplitude;</div><div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;} acc_obstacle_t;</div><div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;```</div><div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;</div><div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;Amplitude is absolute value of complex IQ data and distance is the estimated distance in meters. Radial velocity is the radial velocity towards the sensor.</div><div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;</div><div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;![](obstacle_output.png)</div><div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;</div><div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;Radial velocity is used to estimate the angle of an obstacle using</div><div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;</div><div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;![](obstacle_output_2.png)</div><div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;</div><div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;# Configuring the Obstacle Detector</div><div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;</div><div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;## Create an Obstacle Configuration</div><div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;</div><div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;To start configuring the obstacle detector, an obstacle configuration must be created. The configuration will contain default parameter settings.</div><div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;</div><div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;```c</div><div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;// Create an obstacle configuation</div><div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160;acc_detector_obstacle_configuration_t configuration = acc_detector_obstacle_configuration_create();</div><div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160;```</div><div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;</div><div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160;## Setting General Settings</div><div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160;</div><div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;General settings are similar to the other services and detectors. These settings determine how the ensor will generate data.</div><div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160;</div><div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160;###  Setting Range Start</div><div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160;</div><div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160;Configure how far from the sensor the detection range will start.</div><div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160;</div><div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160;```c</div><div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160;// Set range start to 0.12 meters</div><div class="line"><a name="l00117"></a><span class="lineno">  117</span>&#160;acc_detector_obstacle_configuration_set_range_start(configuration, 0.12f);</div><div class="line"><a name="l00118"></a><span class="lineno">  118</span>&#160;```</div><div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160;</div><div class="line"><a name="l00120"></a><span class="lineno">  120</span>&#160;### Setting Range Length</div><div class="line"><a name="l00121"></a><span class="lineno">  121</span>&#160;</div><div class="line"><a name="l00122"></a><span class="lineno">  122</span>&#160;Configure how long the detection range will be. Maximum length of detection range will depend on hardware computation power.</div><div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160;</div><div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160;```c</div><div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160;// Set range length to 0.3 meters</div><div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160;acc_detector_obstacle_configuration_set_range_length(configuration, 0.3f);</div><div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160;```</div><div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160;</div><div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160;### Setting Sensor</div><div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160;</div><div class="line"><a name="l00131"></a><span class="lineno">  131</span>&#160;When using a connector board with multiple sensors, configure which sensor should be used by the detector. If multiple sensors should be used, they must be configured separately.</div><div class="line"><a name="l00132"></a><span class="lineno">  132</span>&#160;</div><div class="line"><a name="l00133"></a><span class="lineno">  133</span>&#160;```c</div><div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160;// Set detector to use sensor 1</div><div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160;acc_detector_obstacle_configuration_set_sensor(configuration, 1);</div><div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160;```</div><div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160;</div><div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160;### Setting Gain</div><div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160;</div><div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160;Advanced users can control the receiver gain in the sensor. This may be useful for example in cases when measuring reflections from strong reflectors close to the sensor. The gain vale must be between 0.0 and 1.0, where 0.0 is the lowest gain and 1.0 is the highest gain.</div><div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160;</div><div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160;```c</div><div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160;// Set receiver gain to 0.7</div><div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160;acc_detector_obstacle_configuration_set_gain(configuration, 0.7f);</div><div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160;```</div><div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160;</div><div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160;##  Setting Detector Specific Settings</div><div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160;</div><div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160;### Setting Max Number of Obstacles</div><div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160;</div><div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160;Configure how many obstacles the detector should look for. The number of obstacles found will affect the calculation time of the algorithm. One physical object may be returned as multiple obstacles, if the detector detects multiple reflections from the same object.</div><div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160;</div><div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160;```c</div><div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160;// Set max nubmer of obstacles to 1</div><div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160;acc_detector_obstacle_configuration_set_max_number_of_obstacles(configuration, 1);</div><div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160;```</div><div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160;</div><div class="line"><a name="l00158"></a><span class="lineno">  158</span>&#160;### Setting Max Speed</div><div class="line"><a name="l00159"></a><span class="lineno">  159</span>&#160;</div><div class="line"><a name="l00160"></a><span class="lineno">  160</span>&#160;This parameter is the speed limit of obstacles moving towards the sensor, i.e. the speed limit of the robot which sensor is mounted on. If moving faster than this, the detector will not be able to properly estimate the angle of the obstacle. The max speed parameter determines in what frequency the sensor will produce data.</div><div class="line"><a name="l00161"></a><span class="lineno">  161</span>&#160;</div><div class="line"><a name="l00162"></a><span class="lineno">  162</span>&#160;```c</div><div class="line"><a name="l00163"></a><span class="lineno">  163</span>&#160;// Set maxumim speed to 0.3 m/s</div><div class="line"><a name="l00164"></a><span class="lineno">  164</span>&#160;acc_detector_obstacle_configuration_set_max_speed(configuration, 0.3f);</div><div class="line"><a name="l00165"></a><span class="lineno">  165</span>&#160;```</div><div class="line"><a name="l00166"></a><span class="lineno">  166</span>&#160;### Setting Allow Reverse</div><div class="line"><a name="l00167"></a><span class="lineno">  167</span>&#160;</div><div class="line"><a name="l00168"></a><span class="lineno">  168</span>&#160;Disabling allow reverse will make it possible to have a higher max speed at a lower frequency. However, the detector will not be able to estimate angle of obstacles moving away from the sensor, i.e. if the sensor is mounted backwards. This setting is recommended if the sensors are mounted in the forward direction.</div><div class="line"><a name="l00169"></a><span class="lineno">  169</span>&#160;</div><div class="line"><a name="l00170"></a><span class="lineno">  170</span>&#160;```c</div><div class="line"><a name="l00171"></a><span class="lineno">  171</span>&#160;// Enable allow reverse</div><div class="line"><a name="l00172"></a><span class="lineno">  172</span>&#160;acc_detector_obstacle_configuration_set_allow_reverse(configuration, true);</div><div class="line"><a name="l00173"></a><span class="lineno">  173</span>&#160;// Disable allow reverse</div><div class="line"><a name="l00174"></a><span class="lineno">  174</span>&#160;acc_detector_obstacle_configuration_set_allow_reverse(configuration, false);</div><div class="line"><a name="l00175"></a><span class="lineno">  175</span>&#160;```</div><div class="line"><a name="l00176"></a><span class="lineno">  176</span>&#160;</div><div class="line"><a name="l00177"></a><span class="lineno">  177</span>&#160;### Setting Downsample Scale</div><div class="line"><a name="l00178"></a><span class="lineno">  178</span>&#160;</div><div class="line"><a name="l00179"></a><span class="lineno">  179</span>&#160;Down sampling sensor data will increase the speed of the detection algorithm but may decrease the accuracy of distance and angle estimations.</div><div class="line"><a name="l00180"></a><span class="lineno">  180</span>&#160;</div><div class="line"><a name="l00181"></a><span class="lineno">  181</span>&#160;```c</div><div class="line"><a name="l00182"></a><span class="lineno">  182</span>&#160;// Set down sample scale to 8</div><div class="line"><a name="l00183"></a><span class="lineno">  183</span>&#160;acc_detector_obstacle_configuration_set_downsample_scale(configuration, 8);</div><div class="line"><a name="l00184"></a><span class="lineno">  184</span>&#160;```</div><div class="line"><a name="l00185"></a><span class="lineno">  185</span>&#160;</div><div class="line"><a name="l00186"></a><span class="lineno">  186</span>&#160;### Setting Edge to Peak Ratio</div><div class="line"><a name="l00187"></a><span class="lineno">  187</span>&#160;</div><div class="line"><a name="l00188"></a><span class="lineno">  188</span>&#160;To improve distance estimation, edge detection can be used. Edge to peak ratio controls the ratio between the peak amplitude and the edge amplitude. The edge amplitude will never be lower than the configured threshold.</div><div class="line"><a name="l00189"></a><span class="lineno">  189</span>&#160;</div><div class="line"><a name="l00190"></a><span class="lineno">  190</span>&#160;```c</div><div class="line"><a name="l00191"></a><span class="lineno">  191</span>&#160;// Set edge to peak ratio to 0.5</div><div class="line"><a name="l00192"></a><span class="lineno">  192</span>&#160;acc_detector_obstacle_configuration_set_edge_to_peak_ratio(configuration, 0.5f);</div><div class="line"><a name="l00193"></a><span class="lineno">  193</span>&#160;```</div><div class="line"><a name="l00194"></a><span class="lineno">  194</span>&#160;</div><div class="line"><a name="l00195"></a><span class="lineno">  195</span>&#160;### Setting Distance Offset</div><div class="line"><a name="l00196"></a><span class="lineno">  196</span>&#160;</div><div class="line"><a name="l00197"></a><span class="lineno">  197</span>&#160;Distance offset can be used to remove absolute offset error in distance estimation. Depending on sensor integration, an absolute error can be introduced to the distance estimation. The value will be subtracted from the estimated distance.</div><div class="line"><a name="l00198"></a><span class="lineno">  198</span>&#160;</div><div class="line"><a name="l00199"></a><span class="lineno">  199</span>&#160;```c</div><div class="line"><a name="l00200"></a><span class="lineno">  200</span>&#160;// Set distance offset to 0.01 meters</div><div class="line"><a name="l00201"></a><span class="lineno">  201</span>&#160;acc_detector_obstacle_configuration_set_distance_offset(configuration, 0.01f);</div><div class="line"><a name="l00202"></a><span class="lineno">  202</span>&#160;```</div><div class="line"><a name="l00203"></a><span class="lineno">  203</span>&#160;</div><div class="line"><a name="l00204"></a><span class="lineno">  204</span>&#160;### Setting Range End Over-scan</div><div class="line"><a name="l00205"></a><span class="lineno">  205</span>&#160;</div><div class="line"><a name="l00206"></a><span class="lineno">  206</span>&#160;The sensor will be set to sweep farther than the range. This will improve distance estimation close to the end of the range. If set to 0.03 meters, the sensor will sweep 0.03 meters beyond the end range but obstacle detection will still be done within the range.</div><div class="line"><a name="l00207"></a><span class="lineno">  207</span>&#160;</div><div class="line"><a name="l00208"></a><span class="lineno">  208</span>&#160;```c</div><div class="line"><a name="l00209"></a><span class="lineno">  209</span>&#160;// Set range end overscan to 0.03 meters</div><div class="line"><a name="l00210"></a><span class="lineno">  210</span>&#160;acc_detector_obstacle_configuration_set_range_end_overscan(configuration, 0.03f);</div><div class="line"><a name="l00211"></a><span class="lineno">  211</span>&#160;```</div><div class="line"><a name="l00212"></a><span class="lineno">  212</span>&#160;</div><div class="line"><a name="l00213"></a><span class="lineno">  213</span>&#160;### Setting Speed Filter High Pass</div><div class="line"><a name="l00214"></a><span class="lineno">  214</span>&#160;</div><div class="line"><a name="l00215"></a><span class="lineno">  215</span>&#160;Objects that have a radial speed towards the sensor lower than the highpass masking speed are not reported in the output. Set the high-pass masking for radial speed. The value represents the center of the gradient transition from zero amplitude to unchanged amplitude.</div><div class="line"><a name="l00216"></a><span class="lineno">  216</span>&#160;</div><div class="line"><a name="l00217"></a><span class="lineno">  217</span>&#160;```c</div><div class="line"><a name="l00218"></a><span class="lineno">  218</span>&#160;// Set highpass masking for radial speed to 0.01 m/s</div><div class="line"><a name="l00219"></a><span class="lineno">  219</span>&#160;acc_detector_obstacle_configuration_set_speed_filter_highpass(configuration, 0.01f);</div><div class="line"><a name="l00220"></a><span class="lineno">  220</span>&#160;```</div><div class="line"><a name="l00221"></a><span class="lineno">  221</span>&#160;</div><div class="line"><a name="l00222"></a><span class="lineno">  222</span>&#160;## Setting Background Estimation</div><div class="line"><a name="l00223"></a><span class="lineno">  223</span>&#160;</div><div class="line"><a name="l00224"></a><span class="lineno">  224</span>&#160;In background estimation and cancellation, the average signal power for all different speed indexes are recorded during the estimation and later subtracted from the signal.</div><div class="line"><a name="l00225"></a><span class="lineno">  225</span>&#160;</div><div class="line"><a name="l00226"></a><span class="lineno">  226</span>&#160;The number of iterations that should be used for background estimation is configurable. Setting to zero will disable background estimation. A higher number of iterations will improve the background estimation.</div><div class="line"><a name="l00227"></a><span class="lineno">  227</span>&#160;</div><div class="line"><a name="l00228"></a><span class="lineno">  228</span>&#160;```c</div><div class="line"><a name="l00229"></a><span class="lineno">  229</span>&#160;// Set background estimation iterations to 10</div><div class="line"><a name="l00230"></a><span class="lineno">  230</span>&#160;acc_detector_obstacle_configuration_set_background_estimation_iterations(configuration, 10);</div><div class="line"><a name="l00231"></a><span class="lineno">  231</span>&#160;```</div><div class="line"><a name="l00232"></a><span class="lineno">  232</span>&#160;</div><div class="line"><a name="l00233"></a><span class="lineno">  233</span>&#160;## Setting Thresholds</div><div class="line"><a name="l00234"></a><span class="lineno">  234</span>&#160;</div><div class="line"><a name="l00235"></a><span class="lineno">  235</span>&#160;By configuring amplitude thresholds in the detector, it is possible to control the sensitivity of the detector. The thresholds should be set high enough to avoid getting false detections caused by noise, and low enough to not miss detections from small objects.</div><div class="line"><a name="l00236"></a><span class="lineno">  236</span>&#160;</div><div class="line"><a name="l00237"></a><span class="lineno">  237</span>&#160;Close to the sensor, we have the static reflections from sensor casing and floor. Here we use the stationary threshold. It makes sure that stationary reflections are not reported as object detections.</div><div class="line"><a name="l00238"></a><span class="lineno">  238</span>&#160;</div><div class="line"><a name="l00239"></a><span class="lineno">  239</span>&#160;We use the moving threshold for objects that moves towards or away from the sensor. We also use the moving threshold for objects that are further away from the sensor than distance_limit_far. Above this distance we assume that there is no contribution from stationary clutter caused by stationary objects. This makes it possible to detect objects at angles close to 90 degree if they are above distance_limit_far.</div><div class="line"><a name="l00240"></a><span class="lineno">  240</span>&#160;</div><div class="line"><a name="l00241"></a><span class="lineno">  241</span>&#160;```c</div><div class="line"><a name="l00242"></a><span class="lineno">  242</span>&#160;// Set amplitude thresholds</div><div class="line"><a name="l00243"></a><span class="lineno">  243</span>&#160;const acc_detector_obstacle_configuration_threshold_t thresholds =</div><div class="line"><a name="l00244"></a><span class="lineno">  244</span>&#160;{</div><div class="line"><a name="l00245"></a><span class="lineno">  245</span>&#160; .stationary = 0.05f,</div><div class="line"><a name="l00246"></a><span class="lineno">  246</span>&#160; .moving = 0.02f,</div><div class="line"><a name="l00247"></a><span class="lineno">  247</span>&#160; .distance_limit_far = 0.25f</div><div class="line"><a name="l00248"></a><span class="lineno">  248</span>&#160;};</div><div class="line"><a name="l00249"></a><span class="lineno">  249</span>&#160;acc_detector_obstacle_configuration_set_thresholds(configuration, &amp;thresholds);</div><div class="line"><a name="l00250"></a><span class="lineno">  250</span>&#160;```</div><div class="line"><a name="l00251"></a><span class="lineno">  251</span>&#160;</div><div class="line"><a name="l00252"></a><span class="lineno">  252</span>&#160;# Running Obstacle Detector</div><div class="line"><a name="l00253"></a><span class="lineno">  253</span>&#160;</div><div class="line"><a name="l00254"></a><span class="lineno">  254</span>&#160;## Creating and Activating the Detector</div><div class="line"><a name="l00255"></a><span class="lineno">  255</span>&#160;</div><div class="line"><a name="l00256"></a><span class="lineno">  256</span>&#160;When a configuration has been created and configured, the detector can be created. The configuration is validated, and memory needed by the detector is allocated during creation.</div><div class="line"><a name="l00257"></a><span class="lineno">  257</span>&#160;</div><div class="line"><a name="l00258"></a><span class="lineno">  258</span>&#160;```c</div><div class="line"><a name="l00259"></a><span class="lineno">  259</span>&#160;// Create an obstacle detector</div><div class="line"><a name="l00260"></a><span class="lineno">  260</span>&#160;acc_detector_obstacle_handle_t handle = acc_detector_obstacle_create(configuration);</div><div class="line"><a name="l00261"></a><span class="lineno">  261</span>&#160;if (handle == NULL)</div><div class="line"><a name="l00262"></a><span class="lineno">  262</span>&#160;{</div><div class="line"><a name="l00263"></a><span class="lineno">  263</span>&#160; /* Handle error */</div><div class="line"><a name="l00264"></a><span class="lineno">  264</span>&#160;}</div><div class="line"><a name="l00265"></a><span class="lineno">  265</span>&#160;```</div><div class="line"><a name="l00266"></a><span class="lineno">  266</span>&#160;</div><div class="line"><a name="l00267"></a><span class="lineno">  267</span>&#160;If detector creation returns NULL, an error has occurred. Otherwise the detector is ready to be activated.</div><div class="line"><a name="l00268"></a><span class="lineno">  268</span>&#160;</div><div class="line"><a name="l00269"></a><span class="lineno">  269</span>&#160;```c</div><div class="line"><a name="l00270"></a><span class="lineno">  270</span>&#160;// Activate an obstacle detector</div><div class="line"><a name="l00271"></a><span class="lineno">  271</span>&#160;bool status = acc_detector_obstacle_activate(handle);</div><div class="line"><a name="l00272"></a><span class="lineno">  272</span>&#160;if (!status)</div><div class="line"><a name="l00273"></a><span class="lineno">  273</span>&#160;{</div><div class="line"><a name="l00274"></a><span class="lineno">  274</span>&#160; /* Handle error and destroy obstacle detector */</div><div class="line"><a name="l00275"></a><span class="lineno">  275</span>&#160;}</div><div class="line"><a name="l00276"></a><span class="lineno">  276</span>&#160;```</div><div class="line"><a name="l00277"></a><span class="lineno">  277</span>&#160;</div><div class="line"><a name="l00278"></a><span class="lineno">  278</span>&#160;When the detector is activated it will be possible to start retrieving obstacles from the detector.</div><div class="line"><a name="l00279"></a><span class="lineno">  279</span>&#160;</div><div class="line"><a name="l00280"></a><span class="lineno">  280</span>&#160;## Deactivating and Destroying the Detector</div><div class="line"><a name="l00281"></a><span class="lineno">  281</span>&#160;</div><div class="line"><a name="l00282"></a><span class="lineno">  282</span>&#160;To stop measurements, the detector must be deactivated.</div><div class="line"><a name="l00283"></a><span class="lineno">  283</span>&#160;</div><div class="line"><a name="l00284"></a><span class="lineno">  284</span>&#160;```c</div><div class="line"><a name="l00285"></a><span class="lineno">  285</span>&#160;// Deactivate an obstacle detector</div><div class="line"><a name="l00286"></a><span class="lineno">  286</span>&#160;bool status = acc_detector_obstacle_deactivate(handle);</div><div class="line"><a name="l00287"></a><span class="lineno">  287</span>&#160;if (!status)</div><div class="line"><a name="l00288"></a><span class="lineno">  288</span>&#160;{</div><div class="line"><a name="l00289"></a><span class="lineno">  289</span>&#160; /* Handle error and destroy obstacle detector */</div><div class="line"><a name="l00290"></a><span class="lineno">  290</span>&#160;}</div><div class="line"><a name="l00291"></a><span class="lineno">  291</span>&#160;```</div><div class="line"><a name="l00292"></a><span class="lineno">  292</span>&#160;</div><div class="line"><a name="l00293"></a><span class="lineno">  293</span>&#160;When the detector is stopped it can be destroyed to deallocate resources used by the detector.</div><div class="line"><a name="l00294"></a><span class="lineno">  294</span>&#160;</div><div class="line"><a name="l00295"></a><span class="lineno">  295</span>&#160;```c</div><div class="line"><a name="l00296"></a><span class="lineno">  296</span>&#160;// Destroy an obstacle detector</div><div class="line"><a name="l00297"></a><span class="lineno">  297</span>&#160;acc_detector_obstacle_destory(&amp;handle);</div><div class="line"><a name="l00298"></a><span class="lineno">  298</span>&#160;```</div><div class="line"><a name="l00299"></a><span class="lineno">  299</span>&#160;</div><div class="line"><a name="l00300"></a><span class="lineno">  300</span>&#160;# Tuning the Detector</div><div class="line"><a name="l00301"></a><span class="lineno">  301</span>&#160;</div><div class="line"><a name="l00302"></a><span class="lineno">  302</span>&#160;In order to achieve the best possible detector performance, it is important to conduct proper tuning of the detector for each application and hardware integration. There are several parameters that require tuning.</div><div class="line"><a name="l00303"></a><span class="lineno">  303</span>&#160;</div><div class="line"><a name="l00304"></a><span class="lineno">  304</span>&#160;Thresholds for obstacle detection: if the amplitude of a found obstacle is below the threshold it will be discarded.</div><div class="line"><a name="l00305"></a><span class="lineno">  305</span>&#160;</div><div class="line"><a name="l00306"></a><span class="lineno">  306</span>&#160;Background estimation: it is usually necessary to perform a background estimation as sensor enclosure, housing and surroundings of the sensor may generate reflections. The better the background estimation, the lower thresholds can be used.</div><div class="line"><a name="l00307"></a><span class="lineno">  307</span>&#160;</div><div class="line"><a name="l00308"></a><span class="lineno">  308</span>&#160;For both threshold tuning and background estimation, Acconeer offers an easy-to-use Python based graphical user interface (available upon request).</div><div class="line"><a name="l00309"></a><span class="lineno">  309</span>&#160;</div><div class="line"><a name="l00310"></a><span class="lineno">  310</span>&#160;## Background Estimation</div><div class="line"><a name="l00311"></a><span class="lineno">  311</span>&#160;</div><div class="line"><a name="l00312"></a><span class="lineno">  312</span>&#160;The detector offers a method for background estimation and cancellation. Measurements need to be performed with empty space in front of the sensor, but with full enclosure and housing.</div><div class="line"><a name="l00313"></a><span class="lineno">  313</span>&#160;</div><div class="line"><a name="l00314"></a><span class="lineno">  314</span>&#160;For most cases, background estimation and cancellation is recommended, as it allows to set lower thresholds. With this method we estimate a full FFT background map. This map is subtracted from each FFT calculated, when the detector is running. For estimating a good background map, we recommend using 10 iterations, which means collecting 16 · 10 = 160 sweeps.</div><div class="line"><a name="l00315"></a><span class="lineno">  315</span>&#160;</div><div class="line"><a name="l00316"></a><span class="lineno">  316</span>&#160;## Thresholds</div><div class="line"><a name="l00317"></a><span class="lineno">  317</span>&#160;</div><div class="line"><a name="l00318"></a><span class="lineno">  318</span>&#160;Setting too low thresholds will result in an increased number of false detections, while setting too high thresholds will result in reduced detector sensitivity and increased number of missed objects. Thus, finding the right thresholds is very important.</div><div class="line"><a name="l00319"></a><span class="lineno">  319</span>&#160;</div><div class="line"><a name="l00320"></a><span class="lineno">  320</span>&#160;In the most basic setup, two different thresholds need to set, one for moving objects and one for static objects. The threshold for static objects is typically higher since enclosure, housing and surroundings are seen as static objects and need to be removed properly. Thresholds for moving objects, on the other hand, can be much lower.</div><div class="line"><a name="l00321"></a><span class="lineno">  321</span>&#160;</div><div class="line"><a name="l00322"></a><span class="lineno">  322</span>&#160;For a more detailed explanation of the different thresholds that can be set we would like to refer you the available tuning tool and its documentation.</div></div><!-- fragment --></div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="obstacle_8md.html">obstacle.md</a></li>
    <li class="footer">Generated on Mon Dec 2 2019 09:40:46 for Acconeer API by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.13 </li>
  </ul>
</div>
</body>
</html>
